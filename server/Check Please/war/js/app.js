var device=device||{};!function(){"use strict";function e(e){return function(t,i){do;while(!1);return t=e(t),1==arguments.length?(i=localStorage.getItem(t),void 0==i?void 0:JSON.parse(i)):(void 0!==i?localStorage.setItem(t,JSON.stringify(i)):localStorage.removeItem(t),i)}}device.ccPassReq=op.id.c(!0),device.ccPassAllowed=op.id.c(!0),device.getPlatform=op.id.c("web: "+navigator.userAgent),device.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)})},device.ajax=ajax,device.getTableInfo=function(e){var t=window.location.search;if(0==t.length)e(null,0);else{var i=t.indexOf("&");-1==i?e(t.slice(1)):e(t.slice(1,i))}},device.getDebugID=function(){var e="debugID",t=window.location.search,i=t.indexOf("&"+e+"=");if(-1==i)return null;t=t.slice(i+1+e.length+1);var n=t.indexOf(n);return-1!=n&&(t=t.slice(0,n)),t},device.updateNav=function(){},device.getPosInner=function(e){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){e(t.coords)},function(t){e(t)},{enableHighAccuracy:!0,maximumAge:0}):e({code:2,message:"No geolocation available.  Please upgrade your browser"})},device.getPos=function(e){function t(){clearTimeout(n),n=void 0,e(i.latitude,i.longitude,i.accuracy,i.code,i.message)}var i={code:3,message:"Still waiting for user decision"},n=void 0;device.getPosInner(function(e){i=e,null!=n&&t()}),setTimeout(t,1e3)},device.loadData=op.call,device.getClientID=function(){var e=device.accData("id");return void 0==e&&(e=device.makeUUID(),device.accData("id",e)),e},device.accData=e(op.p.c("acc::")),device.genData=e(op.p.c("gen::"));var t="names";device.getNames=function(){return device.accData(t)||[]},device.logName=function(e){names=device.accData(t)||[],i=names.indexOf(e),0!=i&&(i>0&&names.splice(i,1),names.unshift(e),device.accData(t,names))},device.deleteCards=function(){for(var e=device.getCCs(),t=0;t<e.length;t++)device.accData(e[t].key,void 0);device.accData("CCs",void 0)},device.sha256=function(e){return sjcl.codec.base64.fromBits(sjcl.hash.sha256.hash(e))},device.getCCs=function(){return device.accData("CCs")||[]},device.encrypt=function(e,t){return sjcl.encrypt(t,e,{iter:1e4})},device.decrypt=function(e,t){try{return sjcl.decrypt(t,e,{iter:1e4})}catch(i){return null}};var n=" (no password)";device.storeCC=function(e,t,i,r,o){device.ajax.send("cx","encryptCC",{clientID:device.getClientID(),pan:e,name:t,expr:i,zip:r},function(t){t=t.trim();var i;do i="card_"+randStr();while(void 0!==device.accData(i));for(var r=e.slice(-4);r.length<e.length;)r="X"+r;var a=device.getCCs();a.unshift({preview:r,key:i}),device.accData("CCs",a),null==o?t+=n:t=device.encrypt(t,o),device.accData(i,t)},buildAjaxErrFun("encrypt your information"))},device.getCC=function(e,t){var i=device.accData(e);if(void 0==i)return void 0;if(i.endsWith(n)!=(null==t))return null;if(null==t)return i.substring(0,i.length-n.length);var r=device.decrypt(i,t);if(null==r)return null;for(var o=device.getCCs(),a=0;o[a].key!=e;a++);return o.unshift(o.splice(a,1)[0]),device.accData("CCs",o),r},device.deleteCC=function(e){device.accData(e,void 0);for(var t=device.getCCs(),i=0;t[i].key!=e;i++);t.splice(i,1),device.accData("CCs",t)}}(),function(){"use strict";window.onload=function(){if("localhost"!=window.location.hostname&&"https:"!=window.location.protocol&&(window.location.href="https:"+window.location.href.substring(location.protocol.length)),-1!=navigator.userAgent.indexOf("iPhone")&&$("body").addClass("platform-iOS"),setTimeout(window.onresize,0),$("#loadMsg p").text("Getting location..."),inParallel([device.getTableInfo,device.getPos,device.loadData],function(e,t){function i(){for(var e=0;e<r.length;e++)clearTimeout(r[e]);r=[]}function n(e,t){function n(t){r.length>0&&r.length--,$("#loadMsg p").text(e+" ("+t+"%)...")}i(),n(t);for(var o=1;5>o;o++)r[8-o]=setTimeout(n,2e3*o,t+5*o);for(var o=1;5>o;o++)r[4-o]=setTimeout(n,2e3*(o+4),t+20+o)}if($("#loadMsg p").text("Getting order..."),0==e[1])return location="http://"+location.host+"/website.html",void 0;e=e[0]||"";var r=[];n("Getting order",0),device.ajax.send("cx","init",{isNative:!1,tableInfo:e,clientID:device.getClientID(),platform:device.getPlatform(),lat:t[0],"long":t[1],accuracy:t[2],versionNum:1},function(e){if(i(),e=JSON.parse(e),null!=e.errCode)return mvc.init({err:0==e.errCode?"noKey":1==e.errCode?"invalidKey":2==e.errCode?"empty":5==e.errCode?"reqUpdate":6==e.errCode?"disabled":-1==e.errCode?"sjelin":"500"}),loading.init(),mvc.err.notify(),void 0;e.deleteCCs&&device.deleteCards();var t=JSON.parse(e.restrStyle||"{}");if(mvc.init({key:e.tKey,restrName:e.restrName,restrAddress:e.restrAddress,receiptImg:t.receiptImg,connectionID:e.connectionID,items:e.items,split:e.split,selection:{}}),socket.init(e.channelToken),$("title").text("Pay your ticket at "+e.restrName),null!=t.sheet){var n=$("<link>");n.attr("type","text/css"),n.attr("rel","Stylesheet"),n.attr("media","all"),n.attr("href","/cx/customStyle.css?"+t.sheet),$("head").append(n)}if(null==t.headerImg){var r=$("<span>");r.text(e.restrName),$("#header").append(r)}else{var o=$("<img>");o.attr("src","/cx/headerImg.png?"+t.headerImg),$("#header").append(o)}loading.init(),window.onhashchange(),mvc.views.error.allowReload()},function(){i(),mvc.init({err:"Couldn't connect to the server"}),loading.init(),mvc.err.notify()},function(e){n("Getting order",25*e)})}),null!=device.getDebugID()){var e=$("<script>");e.attr("src","http://jsconsole.com/remote.js?"+device.getDebugID()),$("head").append(e)}nav.init()},window.onerror=function(e,t,i){alert("JavaScript error from "+t+":\n\n"+e+" (Line #"+i+")")}}();var loading=loading||{};!function(){"use strict";function e(){var e=mvc.loadMsg();if(null==e)$("#loadMsg").hide();else{if(e=e.trim(),e.match(/[a-z0-9]\.*$/i))for(;!e.endsWith("...");)e+=".";$("#loadMsg p").text(e),$("#loadMsg").show()}}loading.init=function(){mvc.loadMsg.listen(e),e()}}();var mvc={};!function(){"use strict";var e=!1,t=[];mvc.inited=function(){do;while(!1);return e},mvc.inited.listen=function(e){t.push(e)};var i;["key","restrName","restrAddress","receiptImg","connectionID","items","split","selection","tip","contract","loadMsg","paid","done","err"].forEach(function(e){function t(t){do;while(!1);t=arguments.length?t:i[e],n.each(function(e){e(t)})}var n=[];mvc[e]=function(n){do;while(!1);if(arguments.length>0){var r=i[e];i[e]=n,t(r),window.onresize()}return i[e]},mvc[e].notify=op.call.c(t),mvc[e].listen=function(e){n.push(e)}}),mvc.init=function(n){do;while(!1);do;while(!1);do;while(!1);i=n;for(var r in mvc.views)mvc.views[r].viewName=r;e=!0,t.each(function(e){e(!1)})},mvc.errASAP=function(e){mvc.inited()?mvc.err(e):mvc.inited.listen(function(){mvc.err(e)})},mvc.processedSplit=function(){var e=mvc.split();if(null==e)return null;var t={};for(var i in e)for(var n=0;n<e[i].length;n++){var r=e[i][n];t[r]=(t[r]||0)+1}return t},mvc.processedItems=function(e,t){var i=[];i.subtotal=0,i.fee=0,i.tax=0,i.discount=0,i.serviceCharge=0,i.tipable=0;for(var n=mvc.items(),r=mvc.processedSplit(),o=mvc.selection(),a=0;a<n.length;a++){var s=n[a],c=s.id;if((!e||null==r||o[c])&&(s.paidNum<s.paidDenom||t)){var l=s.paidDenom-s.paidNum,d=s.paidDenom*(1+(e&&r&&r[c]||0)),u=Math.gcd(l,d);l/=u,d/=u;var p=(s.price||0)*l/d/100,h=(s.tax||0)*l/d/100,v=(s.discount||0)*l/d/100,m=(s.serviceCharge||0)*l/d/100,f=(s.tickPrice||0)*l/d/100,g=(s.tickTax||0)*l/d/100,y=(s.tickDiscount||0)*l/d/100,w=(s.tickSC||0)*l/d/100,b=$.extend(!0,[],s.mods);i.push({id:c,num:l,denom:d,name:(1==d?"":"("+l+"/"+d+") ")+s.name,price:money.round(p),tax:money.round(h),discount:money.round(v),serviceCharge:money.round(m),mods:b});for(var x=0;x<b.length;x++){var k=b[x],C=(k.price||0)*l/d/100,S=(k.tax||0)*l/d/100,I=(k.discount||0)*l/d/100,A=(k.serviceCharge||0)*l/d/100;p+=C,h+=S,v+=I,m+=A,k.price=money.round(C),k.tax=money.round(S),k.discount=money.round(I),k.serviceCharge=money.round(A)}i.subtotal+=p-v,i.fee+=f,i.tax+=h+g,i.discount+=y,i.serviceCharge+=m+w,i.tipable+=p+h+f+g}}return i.subtotal=money.round(i.subtotal),i.fee=money.round(i.fee),i.tax=money.round(i.tax),i.discount=money.round(i.discount),i.serviceCharge=money.round(i.serviceCharge),i.tipable=money.round(i.tipable),i.total=i.subtotal+i.fee+i.tax+i.serviceCharge-i.discount,i}}(),function(){"use strict";function e(){return mvc.views[(location.hash||"").slice(1)]||mvc.views.receipt}function t(e,r){if(r=r===!0,!o||r){do;while(!1);o=!0;try{var a=e==mvc.views.feedback;if(null!=mvc.err()&&e!=mvc.views.error)return t(mvc.views.error,!0);if((mvc.paid()||mvc.done())&&!a)return t(mvc.views.feedback,!0);if(e.redirect){var s=e.redirect(i);if(null!=s)return t(s,!0)}if(e==i)return;null==i||a||device.ajax.send("cx","log_pos",{position:e.viewName,tableKey:mvc.key(),connectionID:mvc.connectionID()},$.noop,function(){null!=mvc.err()||n||mvc.err("reload")});var c=$("#view");null!=i&&null!=i.unbuild&&i.unbuild(c,e),window.location.hash="#"+e.viewName,null!=i&&$("body").removeClass(i.viewName),$("body").addClass(e.viewName),null!=e.build&&e.build(c,i),i=e,window.onresize()}finally{o=!1}mvc.err.notify()}}var i=null,n=!1,r="onhashchange"in window;window.onhashchange=function(){mvc.inited()&&t(e())};var o=!1;mvc.split.listen(function(){mvc.done()||mvc.paid()||null!=mvc.loadMsg()||(null==mvc.split()?(mvc.selection({}),i==mvc.views.split&&t(mvc.views.receipt)):mvc.views.split.valid()||t(mvc.views.split))}),mvc.contract.listen(function(){var e=mvc.contract();null!=e&&t(mvc.views[e])}),mvc.paid.listen(function(){mvc.paid()&&(mvc.loadMsg(null),t(mvc.views.feedback))}),mvc.done.listen(function(){mvc.done()&&(mvc.loadMsg(null),t(mvc.views.feedback))}),mvc.items.listen(function(){0==mvc.items().length&&(mvc.loadMsg(null),mvc.done(!0),t(mvc.views.feedback))}),mvc.err.listen(function(){null!=mvc.err()&&(mvc.loadMsg(null),0==$("body").size()?window.onload=t.c(mvc.views.error):t(mvc.views.error))}),window.nav={init:function(){$("#view").on("click","a.confirm",function(){var e=i.nextView&&i.nextView();e&&t(e)}),r||$("#view").on("click","a",function(){var e=$(this).attr("href");e&&"#"==e[0]&&window.onhashchange()})}},window.onkeydown=function(e){13==e.keyCode&&null==mvc.loadMsg()&&$(".confirm:visible").click()},window.onunload=window.onbeforeunload=function(){null==i||null!=mvc.err()||n||(n=!0,device.ajax.send("cx","close",{connectionID:mvc.connectionID()}))}}(),function(){"use strict";window.onresize=function(){var e=$(window),t=.0354*e.width(),i=$("body");if(0!=i.size()){$("html").css("font-size",e.width()+"px"),$(".popup-bg").css("font-size",Math.min(e.width(),e.height())+"px"),function(){}.apply(this,arguments),function(){var e=$("#footer img"),i=t*(window.devicePixelRatio||1)*2.5,n=19>i;if(21.5>i)i=20;else if(60>i){var r=i%5;i=Math.round(i-r+(1.5>r?0:4>r?3:5))}e.attr("src","img/app/cx"+(i>60?"":"_"+i)+".png"),n||i>60?e.removeAttr("style"):e.css("height",Math.round(i/(window.devicePixelRatio||1))+"px")}.apply(this,arguments),i.removeClass("tall"),Math.max(i.get(0).scrollHeight,$("html").get(0).scrollHeight)<=Math.min(i.get(0).clientHeight,$("html").get(0).clientHeight)&&i.addClass("tall");for(var n in mvc.views)i.hasClass(n)&&mvc.views[n].onResize&&mvc.views[n].onResize(Math.floor(t))}}}();var socket=socket||{};!function(){"use strict";function e(){}function t(e){e=e.data.trim().split("\n");var t=e[0].trim().toUpperCase();void 0==o[t]?mvc.err('Unknown command "'+t+'" from channel'):o[t].apply(this,e.slice(1))}function i(e){401==e.code?mvc.err("timeout"):mvc.err("reload")}function n(){}var r=null;socket.init=function(o){r=new goog.appengine.Channel(o).open({onopen:e,onmessage:t,onerror:i,onclose:n}),r.onopen=e,r.onmessage=t,r.onerror=i,r.onclose=n};var o={ITEMS_AND_REMOVE_SPLIT:function(e,t){mvc.items(JSON.parse(e)),null!=mvc.split()&&(delete mvc.split()[t],mvc.split.notify())},ITEMS_AND_RESTORE_SPLIT:function(e,t,i){mvc.items(JSON.parse(e)),i=JSON.parse(i),null!=mvc.split()?(mvc.split()[t]=i,mvc.split.notify()):mvc.split({splitID:i})},SPLIT:function(e,t){var i=JSON.parse(t);null==i?null!=mvc.split()&&delete mvc.split()[e]:(null==mvc.split()&&mvc.split({}),mvc.split()[e]=i),mvc.split.notify()},START_SPLIT:function(){null==mvc.split()?mvc.split({}):mvc.split.notify()},CANCEL_SPLIT:function(){null==mvc.split()?mvc.split.notify():mvc.split(null)},ERR:function(){mvc.err(Array.prototype.join.call(arguments,"\n"))},DONE:function(){mvc.done(!0)},LOAD_UPDATE:function(e,t){switch(parseInt(e)){case 0:mvc.loadMsg(t);break;case-1:null!=t&&alert(t),mvc.loadMsg(null);break;case 1:mvc.loadMsg(null),mvc.paid(!0)}}};socket.close=function(){null!=r&&(r.close(),r=null)}}();var templates=templates||{};templates.cc=function(e,t,i){return"<option db_key="+e+(i?" noPass":"")+">"+t+"</option>"};var templates=templates||{};templates.ccPolicy=function(){return"<p>By agreeing to this document, you recognize that your credit card information will be stored on this device and that is it your responsibility (and your responsibility alone) to maintain the security of the information stored on this device.  Maintaining  security includes (but is not limited to) taking all reasonable measures to keep the device virus-free, ensuring the device is not stolen, and limiting access by need.  <strong>Under no circumstances are Martin Jelin (developer of Checkout Express) or his affiliates responsible for any access to the credit card information stored on this device.</strong></p><p>More information about how we use multiple layers of state of the art encryption to keep your information safe can be found on the Security FAQ.  However, the Security FAQ is in no sense a legal document and should not be considered included as part of this agreement.</p><p>This policy may be changed at any time.  This policy is effective from November 26, 2013</p>"};var templates=templates||{};templates.contract=function(e,t){return'<div class="contract">	<div class="content">'+e+'</div>	<div class="buttons">		'+(t?'			<a class="confirm">Done</a>		':'			<a class="confirm">Agree</a>			<a class="disagree">Disagree</a>		')+"	</div></div>"};var templates=templates||{};templates.cvv=function(){return'<div class="cvv">	<label>Security Code</label>	<input type="text" maxlength="4" />	<div class="explanation">		<a>(what\'s this?)</a>		<div class="popup-bg">			<div class="popup-wrapper">				<p>Your security code can be found on your card</p>				<img src="img/app/CSC_en_US.png" />			</div>		</div>	</div></div>'};var templates=templates||{};templates.demoLink=function(){return'<p>If you just want to view the demo version of the app, tap <a href="#demo">here</a>.</p>'};var templates=templates||{};templates.err=function(e){return'<div id="err">	<h1>Sorry!</h1>	<p>Something went wrong.  We\'re getting the following error message:</p>	<p class="error">'+e+"</p>	<p>Please pay your bill through the waitstaff</p></div>"};var templates=templates||{};templates.err__500=function(){return'<div id="err">	<h1>Sorry!</h1>	<p>We are unable to process your order at this time.  Please pay through the waitstaff</p></div>'};var templates=templates||{};templates.err__disabled=function(){return'<div id="err">	<h1>Sorry!</h1>	<p>The restaurant you are at is not currently accepting payments through this app.  Please pay your bill through the waitstaff and try the app again next time you visit.</p></div>'};var templates=templates||{};templates.err__empty=function(){return"<div id=\"err\">	<h1>Sorry!</h1>	<p>We can't find any unpaid items on your table.  If you've pushed two tables together, you may have to check the other table.  Otherwise, please pay through the waitstaff</p></div>"};var templates=templates||{};templates.err__invalidKey=function(){return'<div id="err">	<h1>Sorry!</h1>	<p>There\'s something wrong with the code which identifies your table.  Please pay through the waitstaff</p></div>'};var templates=templates||{};templates.err__noKey=function(e){return"<div id=\"err\">	<h1>Sorry!</h1>	<p>We can't figure out where you're sitting.  Please make sure "+e+".  If that is not the problem, please pay through the waitstaff</p></div>"};var templates=templates||{};templates.err__reload=function(){return'<div id="err">	<h1>Sorry!</h1>	<p>Please reload the page.</p></div>'};var templates=templates||{};templates.err__reqUpdate=function(e){return'<div id="err">	<h1>Update Required</h1>	<p>An update is required in order to communicate with the server.  Please '+e+"</p></div>"};var templates=templates||{};templates.err__sjelin=function(){return'<div id="err">	<h1>On the way!</h1>	<p>The app is currently down.  Instead, a young man will deliver your check to you by hand.  He\'ll be here in just a few moments</p></div>'};var templates=templates||{};templates.err__timeout=function(){return'<div id="err">	<h1>Sorry!</h1>	<p>Your session has timed out.  Please reload the page.</p></div>'};var templates=templates||{};templates.feedback=function(){return'<div id="feedback">	<h1>Thank you!</h1>	<div class="feedback">		<h3>Rate your experience:</h3>		<div class="ratings">			<a class="bad"><img src="img/app/thumbs-down.png" /></a>			<a class="ok">OK</a>			<a class="just good"><img src="img/app/thumbs-up.png" /></a>			<a class="very good"><img src="img/app/thumbs-up-up.png" /></a>		</div>	</div>	<div class="self-promotion">		<h3>Own a restaurant?</h3>		<p>Email <a href="mailto:sjelin@chkex.com">sjelin@chkex.com</a> to get this app at your restaurant</p>	</div></div>'};var templates=templates||{};templates.itemMod=function(e,t){return'<li class="mod">	<span class="name">'+e+'</span>	<span class="price">'+t+"</span></li>"};var templates=templates||{};templates.pay=function(e,t,i,n){return'<div id="pay">	<h1>Payment Information <img class="ssl" /></h1>	Pick Credit Card:	<select class="cards">		'+e+'		<option>New Credit Card</option>	</select>	<a class="delete">Delete Card</a>	<form class="unencrypted-cc">		'+n+'	</form>	<form class="encrypted-cc">		<div class="password">			<label>Password</label>			<input type="password" />		</div>		'+n+'	</form>	<form class="new-cc">		<div class="pan">			<label>Credit Card Number</label>			<input type="text"  maxlength="19" />		</div>		<div class="name">			<label>Name on card</label>			<input type="text" class="name"  maxlength="26" />		</div>		<div class="expr-month">			<label>Month</label>			<select>				<option>01 - January</option>				<option>02 - February</option>				<option>03 - March</option>				<option>04 - April</option>				<option>05 - May</option>				<option>06 - June</option>				<option>07 - July</option>				<option>08 - August</option>				<option>09 - September</option>				<option>10 - October</option>				<option>11 - November</option>				<option>12 - December</option>			</select>		</div>		<div class="expr-year">			<label>Year</label>			<input type="text" maxlength="4" />		</div>		'+n+'		<div class="zip">			<label>Zip Code</label>			<input type="text" maxlength="5" />		</div>		<div class="save">			<span>				<input type="checkbox" />				Save your credit card for future use			</span>			<a>(Security FAQ)</a>		</div>		'+(t?"			"+(i?'				<div class="req-password">					<span>						<input type="checkbox" />						Require a password to access credit card					</span>				</div>			':"")+'			<div class="password">				<label>Password</label>				<input type="password" />				<span></span>			</div>		':"")+'	</form>	<p class="ccPolicy">My clicking "Pay", you agree to our <a>Credit Card Policy</a></p>	<a class="confirm">Pay</a></div>'};var templates=templates||{};templates.receipt=function(e,t,i,n,r,o,a){return'<div id="receipt">	<div class=\'receipt '+(null!=t?"has-logo":"")+'\'>		<div class="header"></div>		'+(null==t?"":"			<img class='title' src='"+a+"/cx/receiptImg.png?"+t+"' />		")+"		<h2 class='title'>"+e+'</h2>		<h3 class="street address">'+i+"</h3>		"+(null==n?"":"			<h3 class='city address'>"+n+"</h3>		")+'		<ul class="items">'+r+'</ul>		<div class="footer"></div>	</div>	<div><a class="split" href="#split">'+o+'</a></div>	<div class="tip">		<div class="buttons">			Tip:			<a class="seventeen percent">17%</a>			<a class="twenty percent">20%</a>			<a class="twentyfive percent">25%</a>			<a class="other percent">Other</a>		</div>		<div class="input">			Amount: $<input type=\'text\' />			<span class="tipPrct"></span>		</div>	</div>	<a class="confirm">Confirm</a></div>'};var templates=templates||{};templates.receiptItem=function(e,t,i,n){return'<li class="item '+n+'">	<span class="name">'+e+'</span>	<span class="price">'+t+'</span>	<ul class="mods">'+i+"</ul></li>"};var templates=templates||{};templates.secFAQ=function(){return'<h1>Security FAQ (Frequently Asked Questions)</h1><p><strong>Disclaimer:</strong> This is in no sense a legal or technical document.  Some of the details have been simplified for easier reading.  Some information may be out of date.  No one may be held accountable for any misstatement on the part of the writer or misinterpretation on the part of the reader.  For the actual legal agreement, please read the Credit Card Policy.</p><h2><strong>Q:</strong> How do you store credit card information?</h2><p><strong>A:</strong> Your information is encrypted and stored on your device.  We do not store any actual credit card information on our servers.  However, if you are using a service like iCloud, the encrypted information may be backed up on that service.</p><h2><strong>Q:</strong> How do you encrypt credit card information?</h2><p><strong>A:</strong> First, we encrypt your information using a password that only our servers know.  Then, if you specify your own password, we encrypt your information again using that password.  Finally, if your device has secure storage capabilities built in, we use those to encrypt your information a final time.</p><h2><strong>Q:</strong> What password?  I wasn\'t asked for a password.</h2><p><strong>A:</strong> On some devices, we feel that the built in security of the device is enough so that you do not need to enter in your own password</p><h2><strong>Q:</strong> Someone stole my phone and they\'re using it to pay for their meals with my Checkout Express information.  What do I do?</h2><p><strong>A:</strong> You should get your device remotely wiped immediately.  If this is not possible or does not solve the problem, email <a href="mailto:sjelin@chkex.com">sjelin@chkex.com</a> and we can sort this all out.  We can make any previously stored information about your cards for Checkout Express useless in future transactions.   You will not need to cancel your credit card.</p><h2><strong>Q:</strong> What do I do if I forgot my password?</h2><p><strong>A:</strong> If you forgot your password you will have to re-enter your information.  There is no way to reset your password.  This is consequence of the fact that we store your information on your phone instead of on our servers.</p><h2><strong>Q:</strong> Why do I have to enter in my security code every time?</h2><p><strong>A:</strong> The security code is never meant to be stored, and is used to verify that you are physically in possession of the card</p><h2><strong>Q:</strong> Is there any risk that someone will be able to steal credit card information from Checkout Express?</h2><p><strong>A:</strong> There is almost no chance that someone could decrypt your actual credit card information (i.e. your card number, expiration date, etc.) from your device.  In order to do that, they would need unrestricted access to the information on your device, unrestricted access to the information on our servers, your password (if you specified one), and the ability to break any secure storage features built into your device.</p><p>However, if there is a virus on your device, it could theoretically watch your screen and steal your information before it is encrypted.</p><h2><strong>Q:</strong> How do you transmit credit card information?</h2><p><strong>A:</strong> Information is transmitted using a cryptographic protocol, either "TLS" or "SSL".  The exact details may depend on your device.  This is the industry standard method for securely sending information over a network.</p><h2><strong>Q:</strong> How is the credit card information charged?</h2><p><strong>A:</strong> Your information is forwarded along to the restaurantâ€™s Point of Sale software and charged as though you had given your card to the waitstaff and they had manually entered your information into the system</p><h2><strong>Q:</strong> What information is stored?</h2><p><strong>A:</strong> Your full card number, the name on your card, the expiration date of the card, and the billing zip code are all stored.</p><h2><strong>Q:</strong> Does Checkout Express meet the PCI DSS for safely storing and transmitting credit card information?</h2><p><strong>A:</strong> We do not store any credit card information on our servers, so much of the PCI DSS does not apply to us.  We always make sure to encrypt your information if we are sending it over a public network.  We also do whatever we can to make sure the information stored on your device is secure.</p><p>If your credit card information is being backed up through a service like iOS\' Keychain, we have done our best to make sure that storing credit card information in this way is compliant with PCI DSS.  In the specific case of iOS\' Keychain, it\'s worth noting that some apps developed by Apple (e.g. Safari) also use keychain to backup credit card information</p><h2><strong>Q:</strong> How big is the encryption key?</h2><p><strong>A:</strong> 128-bits for AES that we control.</p><h2><strong>Q:</strong> I\'m still not sure I trust you guys.  Could I look at your source code?</h2><p><strong>A:</strong> Currently, yes.  You can find everything at <a href="https://github.com/chkex/cx">https://github.com/chkex/cx</a>.  We may make the repository private in the future though.<p><h2><strong>Q:</strong> How are you integrating with the restaurant\'s Point of Sale software?</h2><p><strong>A:</strong> Have you heard the story of the Mechanical Turk?  Say "hi"</p>'};var templates=templates||{};templates.split=function(e){return'<div id="split">	<p>Tap on the items you want to pay for.  If multiple people tap on the same item, its cost will be shared evenly.</p>	<p>Once <strong>everyone</strong> is done picking their items, click the "confirm" button at the bottom.</p>	<ul class="items">'+e+'</ul>	<a class="confirm">Split</a>	<a class="cancel">Cancel</a></div>'};var templates=templates||{};templates.splitItem=function(e,t,i,n,r,o){return'<li class="item'+(t?" selected":"")+(i>0?" has-others":"")+'">	<a itemID="'+e+'">		<span class="name">'+n+'</span>		<span class="price">'+r+'</span>		<ul class="mods">'+o+'</ul>	</a>	<div class="others">		'+(t?"			Splitting with "+i+" other"+(1!=i?"s":"")+"		":1==i?"			1 other person is paying for this		":"			"+i+" other people are splitting this		")+"	</div></li>"};var templates=templates||{};templates.splitText=function(e){return""+(e?"Click here to change the way the bill is being split":"Click here to split the bill")},mvc.views=mvc.views||{},function(){function e(e,t,i){this.title=e,this.nextView=t,this.readonly=i===!0}e.prototype.build=function(e){this.$view=$(templates.contract(templates[this.viewName](),this.readonly)),this.$view.find("a.disagree").click(mvc.err.c("You cannot use this service if you do not agree to the terms")),e.append(this.$view)},e.prototype.unbuild=function(){mvc.contract()==this.viewName&&mvc.contract(null),this.$view.remove()},e.prototype.redirect=function(){return mvc.contract()!=this.viewName?this.nextView():void 0},e.prototype.onResize=function(e){this.$view.find(".content").height(this.$view.height()-8*e);for(var t=this.$view.find(".buttons a").map(function(){return $(this).outerWidth(!0)}),i=e,n=0;n<t.length;n++)i+=t[n];this.$view.find(".buttons").width(Math.ceil(i)+1+"px")};var t=function(){return window.history&&window.history.back?(window.history.back(),void 0):mvc.views.pay};mvc.views.secFAQ=new e("Security FAQ",t,!0),mvc.views.ccPolicy=new e("Credit Card Policy",t)}(),mvc.views=mvc.views||{},function(){var e=!1;mvc.views.error={title:"Error",build:function(e){var t=mvc.err();"reqUpdate"==t?e.append($(templates.err__reqUpdate("reload the page"))):"noKey"==t?e.append($(templates.err__noKey("you typed in the URL correctly"))):e.append($((templates["err__"+t]||templates.err.c(t))()));var i=!1;return null!=mvc.connectionID()&&device.ajax.send("cx","close",{connectionID:mvc.connectionID(),error:t},i?void 0:$.noop),socket.close(),i?window.location.reload(!1):void 0},redirect:function(){return null==mvc.err()?mvc.views.receipt:void 0},allowReload:function(){e=!0}}}(),mvc.views=mvc.views||{},function(){"use strict";function e(){t[(mvc.done()?"add":"remove")+"Class"]("not-done")}var t;mvc.views.feedback={title:"Feedback",build:function(i){t?t.show():(t=$(templates.feedback()),t.find(".ratings").on("click","a",function(){var e,i=$(this);e=i.hasClass("bad")?-1:i.hasClass("ok")?0:i.hasClass("just")?1:2,t.find(".ratings a").addClass("not-picked"),i.removeClass("not-picked"),device.ajax.send("cx","rate",{tableKey:mvc.key(),connectionID:mvc.connectionID(),rating:e},$.noop,buildAjaxErrFun("send rating"))}),mvc.done.listen(e),i.append(t)),e()},unbuild:function(){t.hide()},redirect:function(){return mvc.done()||mvc.paid()?void 0:mvc.views.receipt}}}(),mvc.views=mvc.views||{},function(){"use strict";function e(){return u.find(".cards").val()==d.text()}function t(e){return e.match(/^(?:62|88|2014|2149)/)||e.split("").reduce(function(e,t,i){return e+parseInt(i%2?t:[0,2,4,6,8,1,3,5,7,9][t])},0)%10==0}function i(){l=null;var i=!0;if(e()){if(u.find(".unencrypted-cc").hide(),u.find(".encrypted-cc").hide(),u.find(".new-cc").show(),u.find(".delete").hide(),u.find(".save input")[0].checked)if(device.ccPassReq())u.find(".new-cc .password").show();else{var n=!1;if(device.ccPassAllowed()&&(n=u.find(".req-password").show().find("input")[0].checked),n){u.find(".new-cc .password").show();var r="",o=u.find(".password input:visible").val();o.length<8?r="Your password should be at least eight characters long":o.length<12&&o.match(/^\d+$/)?r="Your password should either be more than just numbers or be very long":o.match(/^[a-z]*$/i)&&(r="Your password should be more than justa word"),u.find(".password span").text(r)}else u.find(".new-cc .password").hide()}else u.find(".req-password").hide(),u.find(".new-cc .password").hide();var a=u.find(".pan input").val();a.length<8?(l="Enter card number",i=i&&a.length>0):a.match(/^\d+$/)?t(a)||(l="There is a typo in your card number"):l="Your card number must be a number";var s=u.find(".name input").val();s.length<2&&(l="Enter name on card",i=i&&s.length>0);var c=u.find(".expr-year input").val();2!=c.length&&4!=c.length?(l="Enter expiration year",i=i&&c.length>0):c.match(/^\d+$/)||(l="The expiration year must be a number");var d=u.find(".zip input").val();if(d.length<5?(l="Enter zip code",i=i&&d.length>0):d.match(/^\d{5}(?:[-\s]\d{4})?/)||(l="The zip code is not correctly formatted"),device.ccPassReq()&&u.find(".password:visible").length>0){var o=u.find(".password input:visible").val(),r=null;o.length<8?r="Password too short":o.match(/[0-9]/)?o.match(/[a-z]/)?o.match(/[A-Z]/)?o.match(/^[0-9a-z]*$/i)&&(r="Password should be more than just numbers and letters"):r="Password should contain an uppercase letter":r="Password should contain a lowercase letter":r="Password should contain a number",null!=r?(l=r,u.find(".password span").text(r),i=!1):u.find(".password span").text("")}}else{var p=null!=u.find(".cards :selected").attr("noPass");u.find(".unencrypted-cc").toggle(p),u.find(".encrypted-cc").toggle(!p),u.find(".new-cc").hide(),u.find(".delete").show()}var h=u.find(".cvv input:visible").val();null!=h&&h.length<3?(l="Enter security code",i=i&&h.length>0):null==h||h.match(/^\d+$/)||(l="Security code must be a number"),u.find(".confirm")[(i?"remove":"add")+"Class"]("disabled"),window.onresize()}function n(){window.onkeydown=p,p=null,u.find(".cvv .popup-bg").hide()}function r(){p=window.onkeydown,window.onkeydown=n,u.find(".cvv .popup-bg").show()
}function o(){var e=u.find(".cards :selected");if(confirm("Delete card "+e.text()+"?")){device.deleteCC(e.attr("db_key")),e.remove();var t=u.find(".cards");t[0].selectedIndex=t[0].options.length-1,i()}}function a(e){if("INPUT"!=e.target.nodeName.toUpperCase()){var t=$(this).find('input[type="checkbox"]')[0];t.checked=!t.checked,i()}}function s(){if(null!=l)return alert(l),void 0;var t=u.find(".confirm");if(!t.hasClass("loading"))if(t.addClass("loading"),e()){var i=u.find(".pan input").val(),n=u.find(".name input").val(),r=u.find(".expr-year input").val().slice(-2)+u.find(".expr-month select").val().slice(0,2),o=u.find(".zip input").val(),a=u.find(".cvv input:visible").val();u.find(".save input")[0].checked&&setTimeout(device.storeCC.c(i,n,r,o,u.find(".password input:visible").val())||null,0),c(JSON.stringify({pan:i,name:n,expr:r,zip:o}),a)}else setTimeout(function(){var e=device.getCC(u.find(".cards :selected").attr("db_key"),u.find(".password input:visible").val()||null);void 0===e?(alert("Credit card data missing.  You should probably delete this card."),t.removeClass("loading")):null==e?(alert("Incorrect password"),t.removeClass("loading")):c(e,u.find(".cvv input:visible").val())},0)}function c(e,t){for(var i=[],n=[],r=[],o=mvc.processedItems(!0),a=0;a<o.length;a++){var s=o[a];i.push(s.id),n.push(s.num),r.push(s.denom)}device.ajax.send("cx","pay",{tableKey:mvc.key(),connectionID:mvc.connectionID(),ccInfo:e,cvv:t,clientID:device.getClientID(),items:i,nums:n,denoms:r,total:o.subtotal+o.tax-o.discount+o.serviceCharge,tip:mvc.tip()},function(e){e=JSON.parse(e),null==e.loadMsg?(mvc.done(e.done),mvc.paid(!0)):mvc.loadMsg(e.loadMsg),$(".loading").removeClass("loading")},buildAjaxErrFun("pay"))}var l,d,u,p=null;mvc.views.pay={title:"Pay",build:function(e){u?u.show():(u=$(templates.pay(device.getCCs().map(function(e){var t=device.getCC(e.key);return void 0===t?"":templates.cc(e.key,e.preview,!!t)}).join(""),device.ccPassAllowed(),!device.ccPassReq(),templates.cvv())),d=u.find(".cards option").filter(function(){return null==$(this).attr("db_key")}),u.find("select").keydown(i),u.find("input").keydown(i),u.find("select").keyup(i),u.find("input").keyup(i),u.find("select").keypress(i),u.find("input").keypress(i),u.find("select").change(i),u.find("input").change(i),u.find(".cvv .explanation > a").click(r),u.find(".cvv .popup-bg").click(n),u.find(".confirm").click(s),u.find("a.delete").click(o),u.find(".save a").click(mvc.contract.c(mvc.views.secFAQ.viewName)),u.find(".ccPolicy a").click(mvc.contract.c(mvc.views.ccPolicy.viewName)),u.find(".save span").click(a),u.find(".req-password span").click(a),e.append(u),i())},unbuild:function(){u.hide(),null!=p&&(window.onkeydown=p)},redirect:function(){return mvc.views.split.valid()?null==mvc.tip()?mvc.views.receipt:void 0:mvc.views.split},onResize:function(){var e=u.find("img.ssl"),t=e.height();e.attr("src","img/app/ssl_"+(t>=55?"58":t>=37?"52":"22")+".png")}}}(),mvc.views=mvc.views||{},function(){"use strict";function e(){s=s||o.find(".tipPrct");var e=mvc.tip();if(o.find(".tip .percent").removeClass("not-picked"),null==e)s.text(""),o.find(".confirm").addClass("disabled");else{o.find(".tip .percent").addClass("not-picked");var t="other";if(o.find(".confirm").removeClass("disabled"),e>=1e6*a)s.text("Thank you!");else if(e>=1e4*a)s.text("("+Math.round(e/a)+"x)");else if(e>=10*a)s.text("("+Math.round(100*e/a)+"%)");else{var i=Math.round(1e4*e/a)/100,n=Math.min(1,Math.max(.1,100/a));i>17-n&&17+n>i?t="seventeen":i>20-n&&20+n>i?t="twenty":i>25-n&&25+n>i&&(t="twentyfive"),s.text("("+i+"%)")}o.find(".tip ."+t).removeClass("not-picked")}}function t(){var t=mvc.processedItems(!0);a=t.tipable,c.empty();for(var i=0;i<t.length;i++){var n=t[i];c.append($(templates.receiptItem(n.name,money.toStr(n.price-n.discount),n.mods.map(function(e){return templates.itemMod(e.name,0==e.price?"":money.toStr(e.price-e.discount))}).join(""),"")))}var r=templates.receiptItem("","--------","","divider");c.append($(r)),c.append($(templates.receiptItem("Subtotal",money.toStr(t.subtotal),"","subtotal"))),0!=t.fee&&c.append($(templates.receiptItem("Fee",money.toStr(t.fee),"","fee"))),0!=t.discount&&c.append($(templates.receiptItem("Discount",money.toStr(-t.discount),"","discount"))),0!=t.serviceCharge&&c.append($(templates.receiptItem("Service Charge",money.toStr(t.serviceCharge),"","service-charge"))),c.append($(templates.receiptItem("Tax",money.toStr(t.tax),"","tax"))),c.append($(r)),c.append($(templates.receiptItem("Total",money.toStr(t.total),"","total"))),e()}function i(e){e!=l.val()&&l.val(e),e!=p&&(p=e,mvc.tip(0==e.length||"."==e?null:Math.round(100*parseFloat(e))))}function n(){u=null;var e=l.val();i(e.match(/^[0-9]*\.?[0-9]{0,2}$/)?e:p)}function r(e){u=e;var t=money.toStr(money.round(a*e/100),"");i(t)}var o,a,s,c,l,d,u=20,p="";mvc.views.receipt={title:"Receipt",build:function(i,a){if(a!=mvc.views.split||mvc.views.split.valid()||(device.ajax.send("cx/split","cancel",{tableKey:mvc.key(),connectionID:mvc.connectionID()},$.noop),mvc.split(null)),o)d.text(templates.splitText(null!=mvc.split())),o.show();else{var s=/^(.*?),?([^\\,]+,?[a-z ]{2,},?\s*[0-9\\-]{0,10})$/i,p=s.exec(mvc.restrAddress().trim());o=$(templates.receipt(mvc.restrName(),mvc.receiptImg(),p[1],p[2],"<REPLACE_ME />","<R_ME_2 />","")),c=o.find("REPLACE_ME").parent(),d=o.find("R_ME_2").parent(),d.text(templates.splitText(null!=mvc.split())),t(),l=o.find(".tip input"),o.find(".tip .percent.seventeen").click(r.c(17)),o.find(".tip .percent.twenty").click(r.c(20)),o.find(".tip .percent.twentyfive").click(r.c(25)),o.find(".tip .percent.other").click(function(){l.val(""),l.focus(),n()}),l.keyup(n),l.keydown(n),l.keypress(n),mvc.items.listen(t),mvc.split.listen(t),mvc.selection.listen(t),mvc.tip.listen(e),i.append(o)}null!=u?r(u):n()},redirect:function(e){return null==mvc.split()||e==mvc.views.split||mvc.views.split.valid()?void 0:mvc.views.split},unbuild:function(){o.hide()},nextView:function(){return null!=mvc.tip()?mvc.views.pay:(alert("Please enter a tip!"),void 0)}}}(),mvc.views=mvc.views||{},function(){"use strict";function e(e,t,i,n,r){t=t||{},t.tableKey=mvc.key(),t.connectionID=mvc.connectionID(),device.ajax.send("cx/split",e,t,i||$.noop,n,r)}function t(e){var t=a[e],i=null!=mvc.selection()&&!!mvc.selection()[e],n=null==mvc.split()?0:mvc.processedSplit()[e]||0,r=t.mods.map(function(e){var t=e.price-e.discount;return templates.itemMod(e.name,t?money.toStr(t):"")}).join(""),o=$(templates.splitItem(e,i,n,t.name,money.toStr(t.price-t.discount),r));null!=s[e]&&s[e].replaceWith(o),s[e]=o}function i(){var e=mvc.processedItems();if(0!=e.length){var i=null;for(var n in s)null==i?i=s[n]:s[n].remove();s={};var r=[];a={};for(var c=0;c<e.length;c++){var n=e[c].id;a[n]=e[c],t(n),r.push(n)}i.replaceWith(r.map(function(e){return s[e].get(0)})),o()}}function n(){for(var e in a)t(e);o()}function r(){if(null==mvc.split())return!0;if(null==a)return null==mvc.processedSplit();var e=mvc.selection()||{},t=mvc.processedSplit()||{};for(var i in a)if(!e[i]&&!t[i])return!1;return!0}function o(){c.find(".confirm")[(r()?"remove":"add")+"Class"]("disabled")}var a=null,s=null,c=null;mvc.views.split={title:"Split",build:function(t){if(c)c.show();else{c=$(templates.split("<REPLACE_ME />"));var r=c.find("REPLACE_ME");r.parent().on("click","a",function(){var t=$(this).attr("itemID"),i=mvc.selection();e((i[t]=!i[t])?"add":"remove",{itemID:t}),mvc.selection.notify()}),c.find(".cancel").click(function(){e("cancel"),mvc.split(null)}),s={tmp:r},i(),mvc.items.listen(i),mvc.split.listen(n),mvc.selection.listen(n),t.append(c)}null==mvc.split()&&(e("start"),mvc.split({}))},unbuild:function(){c.hide()},nextView:function(){return r()?mvc.views.receipt:(null==mvc.selection()||$.isEmptyObject(mvc.selection())?alert("Tap on the items you which to pay for"):alert("Before you can proceed, everyone must select the items they are paying for.  If some of your friends are unable to use the Checkout Express app or website, you will need to pay in the traditional way through the waitstaff"),void 0)},valid:r}}(),function(){"use strict";function e(e){throw e}function t(t,i,n){4!==i.length&&e(new c.exception.invalid("invalid aes block size"));var r=t.a[n],o=i[0]^r[0],a=i[n?3:1]^r[1],s=i[2]^r[2];i=i[n?1:3]^r[3];var l,d,u,p,h=r.length/4-2,v=4,m=[0,0,0,0];l=t.j[n],t=l[0];var f=l[1],g=l[2],y=l[3],w=l[4];for(p=0;h>p;p++)l=t[o>>>24]^f[a>>16&255]^g[s>>8&255]^y[255&i]^r[v],d=t[a>>>24]^f[s>>16&255]^g[i>>8&255]^y[255&o]^r[v+1],u=t[s>>>24]^f[i>>16&255]^g[o>>8&255]^y[255&a]^r[v+2],i=t[i>>>24]^f[o>>16&255]^g[a>>8&255]^y[255&s]^r[v+3],v+=4,o=l,a=d,s=u;for(p=0;4>p;p++)m[n?3&-p:p]=w[o>>>24]<<24^w[a>>16&255]<<16^w[s>>8&255]<<8^w[255&i]^r[v++],l=o,o=a,a=s,s=i,i=l;return m}function i(e,t){var i,n,r,o=t.slice(0),a=e.q,s=e.a,c=a[0],l=a[1],d=a[2],u=a[3],p=a[4],h=a[5],v=a[6],m=a[7];for(i=0;64>i;i++)16>i?n=o[i]:(n=o[i+1&15],r=o[i+14&15],n=o[15&i]=(n>>>7^n>>>18^n>>>3^n<<25^n<<14)+(r>>>17^r>>>19^r>>>10^r<<15^r<<13)+o[15&i]+o[i+9&15]|0),n=n+m+(p>>>6^p>>>11^p>>>25^p<<26^p<<21^p<<7)+(v^p&(h^v))+s[i],m=v,v=h,h=p,p=u+n|0,u=d,d=l,l=c,c=n+(l&d^u&(l^d))+(l>>>2^l>>>13^l>>>22^l<<30^l<<19^l<<10)|0;a[0]=a[0]+c|0,a[1]=a[1]+l|0,a[2]=a[2]+d|0,a[3]=a[3]+u|0,a[4]=a[4]+p|0,a[5]=a[5]+h|0,a[6]=a[6]+v|0,a[7]=a[7]+m|0}function n(e,t){var i,n=c.random.z[e],r=[];for(i in n)n.hasOwnProperty(i)&&r.push(n[i]);for(i=0;i<r.length;i++)r[i](t)}function r(e){e.a=o(e).concat(o(e)),e.A=new c.cipher.aes(e.a)}function o(e){for(var t=0;4>t&&(e.e[t]=e.e[t]+1|0,!e.e[t]);t++);return e.A.encrypt(e.e)}var a=void 0,s=!1,c={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message},this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message},this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message},this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message},this.message=e}}};"undefined"!=typeof module&&module.exports&&(module.exports=c),c.cipher.aes=function(t){this.j[0][0][0]||this.D();var i,n,r,o,a=this.j[0][4],s=this.j[1];i=t.length;var l=1;for(4!==i&&6!==i&&8!==i&&e(new c.exception.invalid("invalid aes key size")),this.a=[r=t.slice(0),o=[]],t=i;4*i+28>t;t++)n=r[t-1],(0===t%i||8===i&&4===t%i)&&(n=a[n>>>24]<<24^a[n>>16&255]<<16^a[n>>8&255]<<8^a[255&n],0===t%i&&(n=n<<8^n>>>24^l<<24,l=l<<1^283*(l>>7))),r[t]=r[t-i]^n;for(i=0;t;i++,t--)n=r[3&i?t:t-4],o[i]=4>=t||4>i?n:s[0][a[n>>>24]]^s[1][a[n>>16&255]]^s[2][a[n>>8&255]]^s[3][a[255&n]]},c.cipher.aes.prototype={encrypt:function(e){return t(this,e,0)},decrypt:function(e){return t(this,e,1)},j:[[[],[],[],[],[]],[[],[],[],[],[]]],D:function(){var e,t,i,n,r,o,a,s=this.j[0],c=this.j[1],l=s[4],d=c[4],u=[],p=[];for(e=0;256>e;e++)p[(u[e]=e<<1^283*(e>>7))^e]=e;for(t=i=0;!l[t];t^=n||1,i=p[i]||1)for(o=i^i<<1^i<<2^i<<3^i<<4,o=o>>8^255&o^99,l[t]=o,d[o]=t,r=u[e=u[n=u[t]]],a=16843009*r^65537*e^257*n^16843008*t,r=257*u[o]^16843008*o,e=0;4>e;e++)s[e][t]=r=r<<24^r>>>8,c[e][o]=a=a<<24^a>>>8;for(e=0;5>e;e++)s[e]=s[e].slice(0),c[e]=c[e].slice(0)}},c.bitArray={bitSlice:function(e,t,i){return e=c.bitArray.O(e.slice(t/32),32-(31&t)).slice(1),i===a?e:c.bitArray.clamp(e,i-t)},extract:function(e,t,i){var n=Math.floor(-t-i&31);return(-32&(t+i-1^t)?e[t/32|0]<<32-n^e[t/32+1|0]>>>n:e[t/32|0]>>>n)&(1<<i)-1},concat:function(e,t){if(0===e.length||0===t.length)return e.concat(t);var i=e[e.length-1],n=c.bitArray.getPartial(i);return 32===n?e.concat(t):c.bitArray.O(t,n,0|i,e.slice(0,e.length-1))},bitLength:function(e){var t=e.length;return 0===t?0:32*(t-1)+c.bitArray.getPartial(e[t-1])},clamp:function(e,t){if(32*e.length<t)return e;e=e.slice(0,Math.ceil(t/32));var i=e.length;return t&=31,i>0&&t&&(e[i-1]=c.bitArray.partial(t,e[i-1]&2147483648>>t-1,1)),e},partial:function(e,t,i){return 32===e?t:(i?0|t:t<<32-e)+1099511627776*e},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(e,t){if(c.bitArray.bitLength(e)!==c.bitArray.bitLength(t))return s;var i,n=0;for(i=0;i<e.length;i++)n|=e[i]^t[i];return 0===n},O:function(e,t,i,n){var r;for(r=0,n===a&&(n=[]);t>=32;t-=32)n.push(i),i=0;if(0===t)return n.concat(e);for(r=0;r<e.length;r++)n.push(i|e[r]>>>t),i=e[r]<<32-t;return r=e.length?e[e.length-1]:0,e=c.bitArray.getPartial(r),n.push(c.bitArray.partial(t+e&31,t+e>32?i:n.pop(),1)),n},k:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]}},c.codec.utf8String={fromBits:function(e){var t,i,n="",r=c.bitArray.bitLength(e);for(t=0;r/8>t;t++)0===(3&t)&&(i=e[t/4]),n+=String.fromCharCode(i>>>24),i<<=8;return decodeURIComponent(escape(n))},toBits:function(e){e=unescape(encodeURIComponent(e));var t,i=[],n=0;for(t=0;t<e.length;t++)n=n<<8|e.charCodeAt(t),3===(3&t)&&(i.push(n),n=0);return 3&t&&i.push(c.bitArray.partial(8*(3&t),n)),i}},c.codec.hex={fromBits:function(e){var t,i="";for(t=0;t<e.length;t++)i+=((0|e[t])+0xf00000000000).toString(16).substr(4);return i.substr(0,c.bitArray.bitLength(e)/4)},toBits:function(e){var t,i,n=[];for(e=e.replace(/\s|0x/g,""),i=e.length,e+="00000000",t=0;t<e.length;t+=8)n.push(0^parseInt(e.substr(t,8),16));return c.bitArray.clamp(n,4*i)}},c.codec.base64={I:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(e,t,i){var n="",r=0,o=c.codec.base64.I,a=0,s=c.bitArray.bitLength(e);for(i&&(o=o.substr(0,62)+"-_"),i=0;6*n.length<s;)n+=o.charAt((a^e[i]>>>r)>>>26),6>r?(a=e[i]<<6-r,r+=26,i++):(a<<=6,r-=6);for(;3&n.length&&!t;)n+="=";return n},toBits:function(t,i){t=t.replace(/\s|=/g,"");var n,r,o=[],a=0,s=c.codec.base64.I,l=0;for(i&&(s=s.substr(0,62)+"-_"),n=0;n<t.length;n++)r=s.indexOf(t.charAt(n)),0>r&&e(new c.exception.invalid("this isn't base64!")),a>26?(a-=26,o.push(l^r>>>a),l=r<<32-a):(a+=6,l^=r<<32-a);return 56&a&&o.push(c.bitArray.partial(56&a,l,1)),o}},c.codec.base64url={fromBits:function(e){return c.codec.base64.fromBits(e,1,1)},toBits:function(e){return c.codec.base64.toBits(e,1)}},c.hash.sha256=function(e){this.a[0]||this.D(),e?(this.q=e.q.slice(0),this.m=e.m.slice(0),this.g=e.g):this.reset()},c.hash.sha256.hash=function(e){return(new c.hash.sha256).update(e).finalize()},c.hash.sha256.prototype={blockSize:512,reset:function(){return this.q=this.M.slice(0),this.m=[],this.g=0,this},update:function(e){"string"==typeof e&&(e=c.codec.utf8String.toBits(e));var t,n=this.m=c.bitArray.concat(this.m,e);for(t=this.g,e=this.g=t+c.bitArray.bitLength(e),t=512+t&-512;e>=t;t+=512)i(this,n.splice(0,16));return this},finalize:function(){var e,t=this.m,n=this.q,t=c.bitArray.concat(t,[c.bitArray.partial(1,1)]);for(e=t.length+2;15&e;e++)t.push(0);for(t.push(Math.floor(this.g/4294967296)),t.push(0|this.g);t.length;)i(this,t.splice(0,16));return this.reset(),n},M:[],a:[],D:function(){function e(e){return 4294967296*(e-Math.floor(e))|0}var t,i=0,n=2;e:for(;64>i;n++){for(t=2;n>=t*t;t++)if(0===n%t)continue e;8>i&&(this.M[i]=e(Math.pow(n,.5))),this.a[i]=e(Math.pow(n,1/3)),i++}}},c.mode.ccm={name:"ccm",encrypt:function(t,i,n,r,o){var a,s=i.slice(0),l=c.bitArray,d=l.bitLength(n)/8,u=l.bitLength(s)/8;for(o=o||64,r=r||[],7>d&&e(new c.exception.invalid("ccm: iv must be at least 7 bytes")),a=2;4>a&&u>>>8*a;a++);return 15-d>a&&(a=15-d),n=l.clamp(n,8*(15-a)),i=c.mode.ccm.K(t,i,n,r,o,a),s=c.mode.ccm.n(t,s,n,i,o,a),l.concat(s.data,s.tag)},decrypt:function(t,i,n,r,o){o=o||64,r=r||[];var a=c.bitArray,s=a.bitLength(n)/8,l=a.bitLength(i),d=a.clamp(i,l-o),u=a.bitSlice(i,l-o),l=(l-o)/8;for(7>s&&e(new c.exception.invalid("ccm: iv must be at least 7 bytes")),i=2;4>i&&l>>>8*i;i++);return 15-s>i&&(i=15-s),n=a.clamp(n,8*(15-i)),d=c.mode.ccm.n(t,d,n,u,o,i),t=c.mode.ccm.K(t,d.data,n,r,o,i),a.equal(d.tag,t)||e(new c.exception.corrupt("ccm: tag doesn't match")),d.data},K:function(t,i,n,r,o,a){var s=[],l=c.bitArray,d=l.k;if(o/=8,(o%2||4>o||o>16)&&e(new c.exception.invalid("ccm: invalid tag length")),(4294967295<r.length||4294967295<i.length)&&e(new c.exception.bug("ccm: can't deal with 4GiB or more data")),a=[l.partial(8,(r.length?64:0)|o-2<<2|a-1)],a=l.concat(a,n),a[3]|=l.bitLength(i)/8,a=t.encrypt(a),r.length)for(n=l.bitLength(r)/8,65279>=n?s=[l.partial(16,n)]:4294967295>=n&&(s=l.concat([l.partial(16,65534)],[n])),s=l.concat(s,r),r=0;r<s.length;r+=4)a=t.encrypt(d(a,s.slice(r,r+4).concat([0,0,0])));for(r=0;r<i.length;r+=4)a=t.encrypt(d(a,i.slice(r,r+4).concat([0,0,0])));return l.clamp(a,8*o)},n:function(e,t,i,n,r,o){var a,s=c.bitArray;a=s.k;var l=t.length,d=s.bitLength(t);if(i=s.concat([s.partial(8,o-1)],i).concat([0,0,0]).slice(0,4),n=s.bitSlice(a(n,e.encrypt(i)),0,r),!l)return{tag:n,data:[]};for(a=0;l>a;a+=4)i[3]++,r=e.encrypt(i),t[a]^=r[0],t[a+1]^=r[1],t[a+2]^=r[2],t[a+3]^=r[3];return{tag:n,data:s.clamp(t,d)}}},c.mode.ocb2={name:"ocb2",encrypt:function(t,i,n,r,o,a){128!==c.bitArray.bitLength(n)&&e(new c.exception.invalid("ocb iv must be 128 bits"));var s,l=c.mode.ocb2.G,d=c.bitArray,u=d.k,p=[0,0,0,0];n=l(t.encrypt(n));var h,v=[];for(r=r||[],o=o||64,s=0;s+4<i.length;s+=4)h=i.slice(s,s+4),p=u(p,h),v=v.concat(u(n,t.encrypt(u(n,h)))),n=l(n);return h=i.slice(s),i=d.bitLength(h),s=t.encrypt(u(n,[0,0,0,i])),h=d.clamp(u(h.concat([0,0,0]),s),i),p=u(p,u(h.concat([0,0,0]),s)),p=t.encrypt(u(p,u(n,l(n)))),r.length&&(p=u(p,a?r:c.mode.ocb2.pmac(t,r))),v.concat(d.concat(h,d.clamp(p,o)))},decrypt:function(t,i,n,r,o,a){128!==c.bitArray.bitLength(n)&&e(new c.exception.invalid("ocb iv must be 128 bits")),o=o||64;var s,l,d=c.mode.ocb2.G,u=c.bitArray,p=u.k,h=[0,0,0,0],v=d(t.encrypt(n)),m=c.bitArray.bitLength(i)-o,f=[];for(r=r||[],n=0;m/32>n+4;n+=4)s=p(v,t.decrypt(p(v,i.slice(n,n+4)))),h=p(h,s),f=f.concat(s),v=d(v);return l=m-32*n,s=t.encrypt(p(v,[0,0,0,l])),s=p(s,u.clamp(i.slice(n),l).concat([0,0,0])),h=p(h,s),h=t.encrypt(p(h,p(v,d(v)))),r.length&&(h=p(h,a?r:c.mode.ocb2.pmac(t,r))),u.equal(u.clamp(h,o),u.bitSlice(i,m))||e(new c.exception.corrupt("ocb: tag doesn't match")),f.concat(u.clamp(s,l))},pmac:function(e,t){var i,n=c.mode.ocb2.G,r=c.bitArray,o=r.k,a=[0,0,0,0],s=e.encrypt([0,0,0,0]),s=o(s,n(n(s)));for(i=0;i+4<t.length;i+=4)s=n(s),a=o(a,e.encrypt(o(s,t.slice(i,i+4))));return i=t.slice(i),128>r.bitLength(i)&&(s=o(s,n(s)),i=r.concat(i,[-2147483648,0,0,0])),a=o(a,i),e.encrypt(o(n(o(s,n(s))),a))},G:function(e){return[e[0]<<1^e[1]>>>31,e[1]<<1^e[2]>>>31,e[2]<<1^e[3]>>>31,e[3]<<1^135*(e[0]>>>31)]}},c.mode.gcm={name:"gcm",encrypt:function(e,t,i,n,r){var o=t.slice(0);return t=c.bitArray,n=n||[],e=c.mode.gcm.n(!0,e,o,n,i,r||128),t.concat(e.data,e.tag)},decrypt:function(t,i,n,r,o){var a=i.slice(0),l=c.bitArray,d=l.bitLength(a);return o=o||128,r=r||[],d>=o?(i=l.bitSlice(a,d-o),a=l.bitSlice(a,0,d-o)):(i=a,a=[]),t=c.mode.gcm.n(s,t,a,r,n,o),l.equal(t.tag,i)||e(new c.exception.corrupt("gcm: tag doesn't match")),t.data},U:function(e,t){var i,n,r,o,a,s=c.bitArray.k;for(r=[0,0,0,0],o=t.slice(0),i=0;128>i;i++){for((n=0!==(e[Math.floor(i/32)]&1<<31-i%32))&&(r=s(r,o)),a=0!==(1&o[3]),n=3;n>0;n--)o[n]=o[n]>>>1|(1&o[n-1])<<31;o[0]>>>=1,a&&(o[0]^=-520093696)}return r},f:function(e,t,i){var n,r=i.length;for(t=t.slice(0),n=0;r>n;n+=4)t[0]^=4294967295&i[n],t[1]^=4294967295&i[n+1],t[2]^=4294967295&i[n+2],t[3]^=4294967295&i[n+3],t=c.mode.gcm.U(t,e);return t},n:function(e,t,i,n,r,o){var a,s,l,d,u,p,h,v,m=c.bitArray;for(p=i.length,h=m.bitLength(i),v=m.bitLength(n),s=m.bitLength(r),a=t.encrypt([0,0,0,0]),96===s?(r=r.slice(0),r=m.concat(r,[1])):(r=c.mode.gcm.f(a,[0,0,0,0],r),r=c.mode.gcm.f(a,r,[0,0,Math.floor(s/4294967296),4294967295&s])),s=c.mode.gcm.f(a,[0,0,0,0],n),u=r.slice(0),n=s.slice(0),e||(n=c.mode.gcm.f(a,s,i)),d=0;p>d;d+=4)u[3]++,l=t.encrypt(u),i[d]^=l[0],i[d+1]^=l[1],i[d+2]^=l[2],i[d+3]^=l[3];return i=m.clamp(i,h),e&&(n=c.mode.gcm.f(a,s,i)),e=[Math.floor(v/4294967296),4294967295&v,Math.floor(h/4294967296),4294967295&h],n=c.mode.gcm.f(a,n,e),l=t.encrypt(r),n[0]^=l[0],n[1]^=l[1],n[2]^=l[2],n[3]^=l[3],{tag:m.bitSlice(n,0,o),data:i}}},c.misc.hmac=function(e,t){this.L=t=t||c.hash.sha256;var i,n=[[],[]],r=t.prototype.blockSize/32;for(this.o=[new t,new t],e.length>r&&(e=t.hash(e)),i=0;r>i;i++)n[0][i]=909522486^e[i],n[1][i]=1549556828^e[i];this.o[0].update(n[0]),this.o[1].update(n[1])},c.misc.hmac.prototype.encrypt=c.misc.hmac.prototype.mac=function(e){return e=new this.L(this.o[0]).update(e).finalize(),new this.L(this.o[1]).update(e).finalize()},c.misc.pbkdf2=function(t,i,n,r,o){n=n||1e3,(0>r||0>n)&&e(c.exception.invalid("invalid params to pbkdf2")),"string"==typeof t&&(t=c.codec.utf8String.toBits(t)),o=o||c.misc.hmac,t=new o(t);var a,s,l,d,u=[],p=c.bitArray;for(d=1;32*u.length<(r||1);d++){for(o=a=t.encrypt(p.concat(i,[d])),s=1;n>s;s++)for(a=t.encrypt(a),l=0;l<a.length;l++)o[l]^=a[l];u=u.concat(o)}return r&&(u=p.clamp(u,r)),u},c.prng=function(e){this.b=[new c.hash.sha256],this.h=[0],this.F=0,this.t={},this.C=0,this.J={},this.N=this.c=this.i=this.T=0,this.a=[0,0,0,0,0,0,0,0],this.e=[0,0,0,0],this.A=a,this.B=e,this.p=s,this.z={progress:{},seeded:{}},this.l=this.S=0,this.u=1,this.w=2,this.Q=65536,this.H=[0,48,64,96,128,192,256,384,512,768,1024],this.R=3e4,this.P=80},c.prng.prototype={randomWords:function(t,i){var n,a=[];n=this.isReady(i);var s;if(n===this.l&&e(new c.exception.notReady("generator isn't seeded")),n&this.w){n=!(n&this.u),s=[];var l,d=0;for(this.N=s[0]=(new Date).valueOf()+this.R,l=0;16>l;l++)s.push(4294967296*Math.random()|0);for(l=0;l<this.b.length&&(s=s.concat(this.b[l].finalize()),d+=this.h[l],this.h[l]=0,!(!n&&this.F&1<<l));l++);for(this.F>=1<<this.b.length&&(this.b.push(new c.hash.sha256),this.h.push(0)),this.c-=d,d>this.i&&(this.i=d),this.F++,this.a=c.hash.sha256.hash(this.a.concat(s)),this.A=new c.cipher.aes(this.a),n=0;4>n&&(this.e[n]=this.e[n]+1|0,!this.e[n]);n++);}for(n=0;t>n;n+=4)0===(n+1)%this.Q&&r(this),s=o(this),a.push(s[0],s[1],s[2],s[3]);return r(this),a.slice(0,t)},setDefaultParanoia:function(e){this.B=e},addEntropy:function(t,i,r){r=r||"user";var o,s,l=(new Date).valueOf(),d=this.t[r],u=this.isReady(),p=0;switch(o=this.J[r],o===a&&(o=this.J[r]=this.T++),d===a&&(d=this.t[r]=0),this.t[r]=(this.t[r]+1)%this.b.length,typeof t){case"number":i===a&&(i=1),this.b[d].update([o,this.C++,1,i,l,1,0|t]);break;case"object":if(r=Object.prototype.toString.call(t),"[object Uint32Array]"===r){for(s=[],r=0;r<t.length;r++)s.push(t[r]);t=s}else for("[object Array]"!==r&&(p=1),r=0;r<t.length&&!p;r++)"number"!=typeof t[r]&&(p=1);if(!p){if(i===a)for(r=i=0;r<t.length;r++)for(s=t[r];s>0;)i++,s>>>=1;this.b[d].update([o,this.C++,2,i,l,t.length].concat(t))}break;case"string":i===a&&(i=t.length),this.b[d].update([o,this.C++,3,i,l,t.length]),this.b[d].update(t);break;default:p=1}p&&e(new c.exception.bug("random: addEntropy only supports number, array of numbers or string")),this.h[d]+=i,this.c+=i,u===this.l&&(this.isReady()!==this.l&&n("seeded",Math.max(this.i,this.c)),n("progress",this.getProgress()))},isReady:function(e){return e=this.H[e!==a?e:this.B],this.i&&this.i>=e?this.h[0]>this.P&&(new Date).valueOf()>this.N?this.w|this.u:this.u:this.c>=e?this.w|this.l:this.l},getProgress:function(e){return e=this.H[e?e:this.B],this.i>=e?1:this.c>e?1:this.c/e},startCollectors:function(){this.p||(window.addEventListener?(window.addEventListener("load",this.r,s),window.addEventListener("mousemove",this.s,s)):document.attachEvent?(document.attachEvent("onload",this.r),document.attachEvent("onmousemove",this.s)):e(new c.exception.bug("can't attach event")),this.p=!0)},stopCollectors:function(){this.p&&(window.removeEventListener?(window.removeEventListener("load",this.r,s),window.removeEventListener("mousemove",this.s,s)):window.detachEvent&&(window.detachEvent("onload",this.r),window.detachEvent("onmousemove",this.s)),this.p=s)},addEventListener:function(e,t){this.z[e][this.S++]=t},removeEventListener:function(e,t){var i,n,r=this.z[e],o=[];for(n in r)r.hasOwnProperty(n)&&r[n]===t&&o.push(n);for(i=0;i<o.length;i++)n=o[i],delete r[n]},s:function(e){c.random.addEntropy([e.x||e.clientX||e.offsetX||0,e.y||e.clientY||e.offsetY||0],2,"mouse")},r:function(){c.random.addEntropy((new Date).valueOf(),2,"loadtime")}},c.random=new c.prng(6);try{var l=new Uint32Array(32);crypto.getRandomValues(l),c.random.addEntropy(l,1024,"crypto['getRandomValues']")}catch(d){}c.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},encrypt:function(t,i,n,r){n=n||{},r=r||{};var o,a=c.json,s=a.d({iv:c.random.randomWords(4,0)},a.defaults);return a.d(s,n),n=s.adata,"string"==typeof s.salt&&(s.salt=c.codec.base64.toBits(s.salt)),"string"==typeof s.iv&&(s.iv=c.codec.base64.toBits(s.iv)),(!c.mode[s.mode]||!c.cipher[s.cipher]||"string"==typeof t&&100>=s.iter||64!==s.ts&&96!==s.ts&&128!==s.ts||128!==s.ks&&192!==s.ks&&256!==s.ks||2>s.iv.length||4<s.iv.length)&&e(new c.exception.invalid("json encrypt: invalid parameters")),"string"==typeof t&&(o=c.misc.cachedPbkdf2(t,s),t=o.key.slice(0,s.ks/32),s.salt=o.salt),"string"==typeof i&&(i=c.codec.utf8String.toBits(i)),"string"==typeof n&&(n=c.codec.utf8String.toBits(n)),o=new c.cipher[s.cipher](t),a.d(r,s),r.key=t,s.ct=c.mode[s.mode].encrypt(o,i,s.iv,n,s.ts),a.encode(s)},decrypt:function(t,i,n,r){n=n||{},r=r||{};var o=c.json;i=o.d(o.d(o.d({},o.defaults),o.decode(i)),n,!0);var a;return n=i.adata,"string"==typeof i.salt&&(i.salt=c.codec.base64.toBits(i.salt)),"string"==typeof i.iv&&(i.iv=c.codec.base64.toBits(i.iv)),(!c.mode[i.mode]||!c.cipher[i.cipher]||"string"==typeof t&&100>=i.iter||64!==i.ts&&96!==i.ts&&128!==i.ts||128!==i.ks&&192!==i.ks&&256!==i.ks||!i.iv||2>i.iv.length||4<i.iv.length)&&e(new c.exception.invalid("json decrypt: invalid parameters")),"string"==typeof t&&(a=c.misc.cachedPbkdf2(t,i),t=a.key.slice(0,i.ks/32),i.salt=a.salt),"string"==typeof n&&(n=c.codec.utf8String.toBits(n)),a=new c.cipher[i.cipher](t),n=c.mode[i.mode].decrypt(a,i.ct,i.iv,n,i.ts),o.d(r,i),r.key=t,c.codec.utf8String.fromBits(n)},encode:function(t){var i,n="{",r="";for(i in t)if(t.hasOwnProperty(i))switch(i.match(/^[a-z0-9]+$/i)||e(new c.exception.invalid("json encode: invalid property name")),n+=r+'"'+i+'":',r=",",typeof t[i]){case"number":case"boolean":n+=t[i];break;case"string":n+='"'+escape(t[i])+'"';break;case"object":n+='"'+c.codec.base64.fromBits(t[i],0)+'"';break;default:e(new c.exception.bug("json encode: unsupported type"))}return n+"}"},decode:function(t){t=t.replace(/\s/g,""),t.match(/^\{.*\}$/)||e(new c.exception.invalid("json decode: this isn't json!")),t=t.replace(/^\{|\}$/g,"").split(/,/);var i,n,r={};for(i=0;i<t.length;i++)(n=t[i].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i))||e(new c.exception.invalid("json decode: this isn't json!")),r[n[2]]=n[3]?parseInt(n[3],10):n[2].match(/^(ct|salt|iv)$/)?c.codec.base64.toBits(n[4]):unescape(n[4]);return r},d:function(t,i,n){if(t===a&&(t={}),i===a)return t;for(var r in i)i.hasOwnProperty(r)&&(n&&t[r]!==a&&t[r]!==i[r]&&e(new c.exception.invalid("required parameter overridden")),t[r]=i[r]);return t},X:function(e,t){var i,n={};for(i in e)e.hasOwnProperty(i)&&e[i]!==t[i]&&(n[i]=e[i]);return n},W:function(e,t){var i,n={};for(i=0;i<t.length;i++)e[t[i]]!==a&&(n[t[i]]=e[t[i]]);return n}},c.encrypt=c.json.encrypt,c.decrypt=c.json.decrypt,c.misc.V={},c.misc.cachedPbkdf2=function(e,t){var i,n=c.misc.V;return t=t||{},i=t.iter||1e3,n=n[e]=n[e]||{},i=n[i]=n[i]||{firstSalt:t.salt&&t.salt.length?t.salt.slice(0):c.random.randomWords(2,0)},n=t.salt===a?i.firstSalt:t.salt,i[n]=i[n]||c.misc.pbkdf2(e,n,t.iter),{key:i[n].slice(0),salt:n.slice(0)}},window.sjcl=c}();